## 项目

* ### 财务系统

  * 名称：finance-management

  * 简介：店达财务系统，主要业务：收款核销、进销存、毛利率等

  * svn地址：

    * 老代码库：<http://116.228.89.150:25193/svn/dianda/finance_management>
    * 新代码库：<http://116.228.89.150:25193/svn/dianda/finance_management_api>

  * 测试账号密码：12345678910    123456

  * 预发布：[http://211.152.32.59:35006](http://211.152.32.59:35006/)

  * 财务系统测试地址：[http://192.168.1.251:35000](http://192.168.1.251:35000/)

  * 相关人员

    * 项目经理：夏辰未sherry
    * 代码发布系统：<http://192.168.1.220/task/index>

  * 文档：

    * 文档地址：[http://192.168.1.101:19091/dianda-brain/finance-refactor](http://192.168.1.101:19091/dianda-brain/finance-refactor%EF%BC%8C%E4%B9%8B%E5%90%8E%E6%89%80%E6%9C%89%E6%9B%B4%E6%96%B0%E8%A7%81%E6%96%B0%E4%BB%93%E5%BA%93)


    * action:已经审核的单子恢复到原来状态
    * bugs:所有的出现的问题（里面有修复的还有未修复的，已经标记过）
    * doc: 
      * 财务有接口模块文档：
        * 出入检核-收款核销管理
        * 出入检核-退货记录
        * 出入检核-销售分流订单收款管理
        * 采购单列表-采购复核
        * 采购单列表-采购审核
        * 采购单列表-预付款到货跟踪
        * 财务付款-预付款采购付款
        * 财务付款-后付款采购付款
        * 入驻商业务-订单列表
        * 入驻商业务-贷款结算
        * 入驻商业务-结算单列表
        * 入驻商业务-商品列表
        * 财务统计-每日毛利率毛利额
      * 财务无接口文档：
        * ~~出入检核-直销核销管理~~
        * 采购单列表-采购单查询
        * 入驻商业务-入驻商信息
        * 入驻商业务-消息中心
        * 入驻商业务-入驻商退货列表
        * 库存变动明细（全部）
        * 提供单明细（全部）
        * 财务统计-销售毛利统计
        * 财务统计-单品返利
        * 日报数据（全部）
        * 历史数据（全部）
        * 推广（全部）
        * 纯第三方（全部）
        * 贷款结转管理（全部）

  * 依赖：

    * 数据库
      * ctcDB
      * statisticsDB
      * ~~ckDB~~
    * MQ:消息队列
    * rpc:
      * cw
      * qx
      * ck
      * salesman
      * ddpay:支付
    * Redis:用于存会话，否则无法登陆
    * ftp
    * 授权服务器：请求用户授权
    * 图片服务器：储存图片、引用图片
    * 相关工具库
      * 验证：validator、joi
      * 数据库：mysql、sequelize
      * 服务器：express
      * 日志：log4js
      * 消息队列：rabbitmq、amqplib
      * 远程调用：hprose
      * 缓存：redis
      * 测试：mocha

  * 相关联的系统

    * 系统本身：
      * 静态资源：finance-management
      * （http转发）：finance-management-api
      * 进销存服务（mq）：micro-service/fm-in-out-service
    * 定时任务：do-every-day/src/schedule/pullDataOnStoreGoodsOrderDaily.js
    * 数据库共用表，有可能会改：statistic-info-management
    * 若干系统（采销等）在用财务的rpc，见rpc目录
    * 三个系统通过mq与财务产生关联，见mq目录
    * 仓库
    * rpc中继系统
    * 采销系统
    * 知识库
    * jira
    * 店达发布系统
    * 客服系统（关联不是很大）
    * 权限系统
    * 进销存系统
    * do_every_day

  * 注意事项：

    * 除了SVN其他没有外网环境
      * 内网：http://192.168.1.100:8080/svn/dianda
      * 外网：http://116.228.89.150:25193/svn/dianda
    * 老代码库：finance_management
      * Node.js版本：0.12（⚠️注意：安装依赖需要npm版本2.5）

  * TO DO LIST（新需求关联人：张芳）

    * 前置仓功能不完善

    * 发票管理系统

    * 类似钉钉流程管理系统

    * 重构进销存数据流的事务

    * 采购系统重构

    * 财务重构方案

      * 目标：

        * Node版本升级
        * 部分前后端分离
        * 去重冗余（无用的功能）
        * 迁移GitLab（运维）

      * 方案

        * 在GitLab上开一个财务的空项目，该空项目本身以node6以上版本运行，以最小功能先运转的方式起来让其能运行
        * 然后往新财务里面迁移老财务的功能和代码，同时保持老财务的运转（新老财务都是无状态的，它们之间的耦合仅限于数据库）
        * rpc部分改造成mq，然后新老财务系统订阅mq，保证数据的一致性
        * 把原先很大的函数，拆成小函数；做好测试工作

      * 风险点：

        * 由于新财务的存在，要保证非幂等的操作新老财务系统只执行一遍
        * 与新规划是否有冲突，比如财务审核和前置仓之前的一些问题
        * 保证业务与原先的一致性，需要理清模块的具体业务
        * 与3号楼开发进度是否有冲突（耦合的模块），两边开发是否互相影响
        * 迁移到Git导致的相关风险，比如测试、发布相关的流程

      * 排期

        A、把基础的架子搭好（可以考虑finance management api的架子）

        1. 数据库
        2. 接入登陆系统
        3. 日志
        4. 分公司切换
        5. 前端导航
        6. 前端表格

​                           B、先把最常用的几个功能迁移到新系统，分别是

​                               1. 财务审核

​                               2. 付款

​                              3. 收款核销

​                              4. 统计相关功能

​                              5. 毛利

​                              6. 库存明细

​                              7.退供单明细

​                             8.入驻商？

* 文档相关人员：
  * 书写人：齐年庆
  * 接收人：赵渐、张思毅

